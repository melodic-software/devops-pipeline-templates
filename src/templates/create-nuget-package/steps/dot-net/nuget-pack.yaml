steps:
  # https://learn.microsoft.com/en-us/azure/devops/pipelines/tasks/reference/dotnet-core-cli-v2
  # https://learn.microsoft.com/en-us/nuget/reference/msbuild-targets#pack-target
  # https://www.frakkingsweet.com/adding-metadata-to-nuget-packages-in-azure-devops-pipelines/
  - task: DotNetCoreCLI@2
    displayName: NuGet Pack
    condition: succeeded()
    inputs:
      command: custom
      custom: "pack"
      # Manually specify all parameters as arguments to retain `dotnet pack` behavior with custom properties
      arguments: |
        $(SelfRepositoryFolder)/**/$(ProjectName).csproj
        --output $(Build.ArtifactStagingDirectory)
        --configuration $(BuildConfiguration)
        --no-restore
        --no-build
        --include-symbols
        -p:PackageVersion=$(GitVersion_SemVer)
        -p:NugetPackageId=$(NugetPackageId)

  # Regarding the $(NoBuildBeforePack) and "nobuild".
  # In most cases, this can be true since we've already built the project at this point.
  # This might need to be set to false for a package built from a project that has internal project references.
