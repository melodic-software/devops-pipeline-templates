steps:
- task: DotNetCoreCLI@2
  name: RunTestsDotNet
  displayName: Run Tests
  condition: and(succeeded(), ne(variables['DotNetSDKVersion'], ''), eq(variables['RunTests'], true))
  inputs:
    command: 'test'
    # this is a convention - all tests are placed in a "tests" folder at the root
    projects: '$(SelfRepositoryFolder)/test*/**/*.csproj'
    arguments: '--configuration $(Configuration) --collect "$(CodeCoverageFramework)" --verbosity detailed /p:AssemblyOriginatorKeyFile=$(DownloadNuGetSigningKey.secureFilePath)'
    publishTestResults: true  # This is optional but recommended for better tracking of test results

# The use of /p:AssemblyOriginatorKeyFile=$(DownloadNuGetSigningKey.secureFilePath)' is for specific test scenarios.
# BOTH the source AND the test project must be signed if a test project requires internal visibility to the source project, and the source is signed with a strong name key.
# The test project will require these properties:
# <PropertyGroup>
#  <SignAssembly>true</SignAssembly>
#  <AssemblyOriginatorKeyFile>$(AssemblyOriginatorKeyFile)</AssemblyOriginatorKeyFile>
#</PropertyGroup>