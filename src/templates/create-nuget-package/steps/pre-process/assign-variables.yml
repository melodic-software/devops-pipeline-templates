parameters:
- name: testProjects
  type: object
  default: ['*.csproj']

steps:
- task: PowerShell@2
  name: AssignVariables
  displayName: Assign Variables
  condition: succeeded()
  inputs:
    targetType: 'inline'
    script: |
      # Directly pass the parameter as an environment variable using Azure DevOps formatting
      $TestProjects = @('${{ parameters.testProjects }}' -split ',')

      # Define the path prefix
      $PathPrefix = "$(System.DefaultWorkingDirectory)/test*/**/"

      # Initialize the array to hold formatted paths
      $FormattedProjects = @()
      
      # Prefix each project path with the specific directory structure
      foreach ($Project in $TestProjects) {
        $ProjectTrimmed = $Project.Trim().Trim("'")
        $FormattedPath = $PathPrefix + $ProjectTrimmed
        $FormattedProjects += $FormattedPath
      }
      
      # Combine all formatted project paths into a single string for output
      $TestProjectsString = $FormattedProjects -join ';'
      
      # Output the formatted test projects string to the host
      Write-Host "Formatted Test Projects String: $TestProjectsString"
      
      # Set the formatted project paths as a pipeline variable
      Write-Host "##vso[task.setvariable variable=TestProjects;]$TestProjectsString"
    pwsh: true